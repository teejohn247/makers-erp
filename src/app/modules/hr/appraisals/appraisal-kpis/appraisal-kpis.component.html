<div class="content-wrap d-block">

    <div class="row-section mt-lg-2">
        <div class="inner-row-hld d-flex align-items-start justify-content-between">

            <div class="row-card w-100 card-yxl">
                <div class="inner-row d-flex justify-content-between align-items-center mt-lg-2">
                    <div class="card-title md">Appraisal KPI Groups</div>
                    <div class="bulk-actions d-flex justify-content-between align-items-center">
                        <div (click)="createKpiGroup()" class="cta primary-bkg md ms-lg-2">
                            <span class="icon me-1">
                                <app-icon [iconName]="'layerPlus'" [iconWidth]="20" [iconHeight]="20"></app-icon>
                            </span>
                            Add KPI Group
                        </div>
                    </div>
                </div>

                <div *ngIf="!kpiGroups" class="inner-row w-100">
                    <app-loading-data [height]="'15rem'"></app-loading-data>
                </div>

                <div *ngIf="kpiGroups && kpiGroups.length == 0" class="inner-row w-100 my-lg-5">
                    <div class="cont">
                        <app-no-data 
                            [height]="'15rem'"
                            [icon]="'layerPlus'"
                            [message]="'No KPI Groups have been created'"
                        >
                        </app-no-data>
                    </div>
                </div>

                <div *ngIf="kpiGroups && kpiGroups.length > 0" class="inner-row">
                    <div *ngIf="kpiGroups && kpiGroups.length == 0" class="cont mt-lg-3 mt-4">
                        <app-no-data 
                            [height]="'10.5rem'"
                            [icon]="'layer'"
                            [message]="'No KPI Groups created yet'"
                        >
                        </app-no-data>
                    </div>

                    <!-- <div *ngIf="salaryScalesLoading" class="cont mt-lg-3 mt-4 d-flex justify-content-center align-items-center">
                        <span class="loader ms-1"></span>
                    </div> -->

                    <div class="accordion accordion-flush mt-lg-3 mt-3">
                        <div *ngFor="let item of kpiGroups; let i = index" class="accordion-item">
                            <div class="accordion-header" id="{{'flush-heading-scale'+i}}">
                                <button (click)="toggleAccordionInfo(i)" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" [attr.data-bs-target]="'#'+'flush-scale'+i" aria-expanded="false" [attr.aria-controls]="'flush-scale'+i">
                                    <div class="name"><span class="weight checked">{{item.weight}}%</span> {{item.groupName}}</div>
                                    <div class="chips">
                                        <div *ngFor="let dept of item.assignedDepartments; let k = index">
                                            <span class="chip" *ngIf="dept.department_name">{{dept.department_name}}</span>                  
                                        </div>
                                    </div>
                                    <div class="actions">
                                        <div *ngIf="loggedInUser.isSuperAdmin || (item.accessLevel != 'Admin' && loggedInUser.isManager) || (item.accessLevel=='Employee' && !loggedInUser.isSuperAdmin && !loggedInUser.isManager)" (click)="createKpi(item)" class="cta trans-bkg sm">Create KPI</div>
                                        <span *ngIf="loggedInUser.isSuperAdmin || (item.accessLevel != 'Admin' && loggedInUser.isManager)" (click)="updateKpiGroup(item)" class="table-icon edit ms-lg-3 ms-2" style="font-size: 1rem; color: var(--primary);">
                                            <app-icon [iconName]="'edit'" [iconWidth]="15" [iconHeight]="15"></app-icon>
                                        </span>
                                        <span *ngIf="loggedInUser.isSuperAdmin || (item.accessLevel!='Admin' && loggedInUser.isManager)" (click)="deleteKpiGroup(item)" class="icon delete ms-lg-3 ms-2"><i class="bi bi-trash3-fill"></i></span>
                                    </div>
                                    <!-- <div class="app-switch">
                                        <input type="checkbox">
                                    </div> -->
                                </button>
                            </div>
                            <div [class.show]="activeTab == i" id="{{'flush-level'+i}}" class="accordion-collapse collapse" [attr.aria-labelledby]="'flush-heading-scale'+i" data-bs-parent="#accordionFlushExample">
                                <div class="accordion-body pb-lg-4">
                                    <section class="mb-2">{{item.description}}</section>
                                    <div class="headless-table-wrap">
                                        <div class="hdr row-hld">
                                            <div class="row-cell">KPI Name</div>
                                            <div class="row-cell">Weight</div>
                                            <div class="row-cell">Target</div>
                                            <div class="row-cell">Threshold</div>
                                            <div class="row-cell"></div>
                                        </div>
                                        <div *ngFor="let kpi of item.groupKpis; let j = index" class="row-hld">
                                            <div class="row-cell">{{kpi.kpiName}}</div>
                                            <div class="row-cell weight">{{kpi.weight}}%</div>
                                            <div class="row-cell">{{kpi.target.toLocaleString()}}</div>
                                            <div class="row-cell">{{kpi.threshold.toLocaleString()}}</div>
                                            <div class="row-cell">
                                                <div class="actions">
                                                    <span (click)="updateKpi(kpi)" class="table-icon edit" style="font-size: 1rem; color: var(--primary);">
                                                        <app-icon [iconName]="'edit'" [iconWidth]="15" [iconHeight]="15"></app-icon>
                                                    </span>
                                                    <span (click)="deleteKpi(kpi)" class="icon delete ms-lg-3 ms-2"><i class="bi bi-trash3-fill"></i></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
                
            </div>

        </div>
    </div>

    <div class="row-section py-5 my-5"></div>
</div>